<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>DSAN-5000: Project ‚Äì Data Collection</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../assets/gu-logo.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">DSAN-5000: Project</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../report/report.html"> 
<span class="menu-text">Report</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-technical-details" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Technical details</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-technical-details">    
        <li>
    <a class="dropdown-item" href="../../technical-details/data-collection/main.html">
 <span class="dropdown-text">Data-collection</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../technical-details/data-cleaning/main.html">
 <span class="dropdown-text">Data-cleaning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../technical-details/eda/main.html">
 <span class="dropdown-text">Exploratory Data Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../technical-details/unsupervised-learning/main.html">
 <span class="dropdown-text">Unsupervised Learning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../technical-details/supervised-learning/main.html">
 <span class="dropdown-text">Supervised Learning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../technical-details/progress-log.html">
 <span class="dropdown-text">Progress Log</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../technical-details/llm-usage-log.html">
 <span class="dropdown-text">LLM usage Log</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods">Methods</a>
  <ul class="collapse">
  <li><a href="#youtube-data-api-integration" id="toc-youtube-data-api-integration" class="nav-link" data-scroll-target="#youtube-data-api-integration"><strong>YouTube Data API Integration</strong></a></li>
  <li><a href="#custom-functions-for-data-collection" id="toc-custom-functions-for-data-collection" class="nav-link" data-scroll-target="#custom-functions-for-data-collection"><strong>Custom Functions for Data Collection</strong></a></li>
  <li><a href="#data-summary" id="toc-data-summary" class="nav-link" data-scroll-target="#data-summary"><strong>Data Summary</strong></a></li>
  </ul></li>
  <li><a href="#code" id="toc-code" class="nav-link" data-scroll-target="#code">Code</a>
  <ul class="collapse">
  <li><a href="#youtube-data-collection-from-youtube-data-api" id="toc-youtube-data-collection-from-youtube-data-api" class="nav-link" data-scroll-target="#youtube-data-collection-from-youtube-data-api">YouTube Data Collection from YouTube Data API</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a>
  <ul class="collapse">
  <li><a href="#we-finished-data-collection-on-11252024" id="toc-we-finished-data-collection-on-11252024" class="nav-link" data-scroll-target="#we-finished-data-collection-on-11252024">We finished data collection on 11/25/2024</a></li>
  <li><a href="#challenges" id="toc-challenges" class="nav-link" data-scroll-target="#challenges"><strong>Challenges</strong></a></li>
  <li><a href="#benchmarks" id="toc-benchmarks" class="nav-link" data-scroll-target="#benchmarks"><strong>Benchmarks</strong></a></li>
  <li><a href="#conclusion-and-future-steps" id="toc-conclusion-and-future-steps" class="nav-link" data-scroll-target="#conclusion-and-future-steps"><strong>Conclusion and Future Steps</strong></a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Data Collection</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!-- {{< include instructions.qmd >}}  -->
<section id="overview" class="level1">
<h1>Overview</h1>
<p>This section provides a high-level summary for technical staff, outlining the key tasks and processes undertaken in this project. It establishes the context, motivation, and objectives of the work.</p>
<ul>
<li><p><strong>Goals</strong>:<br>
The primary goal of this document is to efficiently collect data from the YouTube API to build a robust dataset for addressing future data science research questions. This involves designing a reliable workflow for data acquisition, using <a href="https://developers.google.com/youtube/v3">Youtube Data API-v3</a> calls to gather video metadata, and curating a dataset of sufficient size and quality.</p></li>
<li><p><strong>Motivation</strong>:<br>
The motivation behind this data collection effort is to source original and reliable data directly from the YouTube API. To ensure the dataset is representative and meaningful, we aim to diversify the collected data by selecting subsets of videos from different countries while limiting topics to reduce noise and ambiguity. This approach allows us to create a focused, high-quality dataset that reflects diverse content while maintaining relevance to our research goals.</p></li>
<li><p><strong>Objectives</strong>:<br>
The specific objectives for data collection are as follows:</p>
<ul>
<li>Randomly retrieve video metadata using the YouTube Data API.<br>
</li>
<li>Select useful video features, such as viewing statistics, to ensure the data supports comprehensive analysis.<br>
</li>
<li>Investigate YouTube‚Äôs recommendation mechanism by retrieving the linked ‚Äúnext page‚Äù videos associated with each video.<br>
</li>
<li>Focus on videos from English-speaking countries (e.g., the United States and the United Kingdom) to maintain consistency in language and cultural context.</li>
</ul></li>
</ul>
<p>This overview provides technical staff with the necessary context to understand the importance of the work and guides them in exploring the details presented in subsequent sections.</p>
</section>
<section id="methods" class="level1">
<h1>Methods</h1>
<p>This section provides an overview of the methods used in this project, including key techniques, tools, and processes for data collection, processing, and analysis. Below, we outline the approach taken to achieve the project‚Äôs objectives.</p>
<section id="youtube-data-api-integration" class="level3">
<h3 class="anchored" data-anchor-id="youtube-data-api-integration"><strong>YouTube Data API Integration</strong></h3>
<p>We used the <code>build</code> function from the YouTube Data API to gather video metadata using a unique API key. This served as the foundation for querying and collecting data directly from YouTube. We included out API key in the comment, but please replace with your own API key over there.</p>
</section>
<section id="custom-functions-for-data-collection" class="level3">
<h3 class="anchored" data-anchor-id="custom-functions-for-data-collection"><strong>Custom Functions for Data Collection</strong></h3>
<ol type="1">
<li><strong><code>retrieve_randomized_videos</code>:</strong>
<ul>
<li>This function was designed to randomly select videos from English-speaking countries, such as the United States (<code>US</code>), the United Kingdom (<code>GB</code>), and Australia (<code>AU</code>).<br>
</li>
<li>A predefined list of video categories/topics was used to randomly choose specific types of videos to include.<br>
</li>
<li>To focus on factors driving high view counts, the <code>chart</code> parameter in the <code>youtube.videos().list()</code> function was set to <code>"mostPopular"</code>.<br>
</li>
<li>The function returns videos that match the specified conditions, including metadata such as content details, statistics, and snippets.</li>
</ul></li>
<li><strong><code>retrieve_200_videos</code>:</strong>
<ul>
<li>This function builds on <code>retrieve_randomized_videos</code> to retrieve up to 200 videos in total.<br>
</li>
<li>If the data retrieved contains a <code>nextPageToken</code>, the function iteratively retrieves additional videos until the limit is reached or no further pages are available.</li>
</ul></li>
<li><strong><code>get_video_details</code>:</strong>
<ul>
<li>This function processes the JSON data returned by the YouTube API to extract key statistics and metadata.<br>
</li>
<li>Examples of extracted data include <code>channelTitle</code> (from the snippet section) and <code>viewCount</code> (from the statistics section).</li>
</ul></li>
</ol>
</section>
<section id="data-summary" class="level3">
<h3 class="anchored" data-anchor-id="data-summary"><strong>Data Summary</strong></h3>
<p>At the end of this data collection workflow, we compiled a dataset containing 13,598 rows and 15 columns, and it contains string data, numerical data, Boolean values and dates, but we won‚Äôt use the dates columns for furthere analysis. This raw dataset (saved in <code>data/raw-data</code>) is now ready for further preprocessing and analysis in the data cleaning stage.</p>
</section>
</section>
<section id="code" class="level1">
<h1>Code</h1>
<section id="youtube-data-collection-from-youtube-data-api" class="level2">
<h2 class="anchored" data-anchor-id="youtube-data-collection-from-youtube-data-api">YouTube Data Collection from YouTube Data API</h2>
<div id="cell-6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dateutil <span class="im">import</span> parser</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Data visualization libraries</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.ticker <span class="im">as</span> ticker</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>(style<span class="op">=</span><span class="st">"darkgrid"</span>, color_codes<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> JSON</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> display_json</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Google API</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> googleapiclient.discovery <span class="im">import</span> build</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-7" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NLP libraries</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> nltk</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.corpus <span class="im">import</span> stopwords</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.tokenize <span class="im">import</span> word_tokenize</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>nltk.download(<span class="st">'stopwords'</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>nltk.download(<span class="st">'punkt'</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> wordcloud <span class="im">import</span> WordCloud</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>[nltk_data] Downloading package stopwords to
[nltk_data]     /Users/shenyuxi/nltk_data...
[nltk_data]   Package stopwords is already up-to-date!
[nltk_data] Downloading package punkt to /Users/shenyuxi/nltk_data...
[nltk_data]   Package punkt is already up-to-date!</code></pre>
</div>
</div>
<div id="cell-8" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pip install --upgrade google-api-python-client</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># youtube_api_key = "YOUR API KEY"</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>youtube <span class="op">=</span> build(<span class="st">'youtube'</span>, <span class="st">'v3'</span>, developerKey<span class="op">=</span>youtube_api_key)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-9" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> retrieve_randomized_videos(token<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    regions <span class="op">=</span> [<span class="st">'US'</span>,<span class="st">'GB'</span>, <span class="st">'AU'</span>, <span class="st">'NZ'</span>, <span class="st">'IE'</span>]  <span class="co"># Example region codes</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    random_region <span class="op">=</span> random.choice(regions)  <span class="co"># Choose a random region</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Retrieve available categories for the selected region</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    random_category <span class="op">=</span> random.choice([<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">17</span>, <span class="dv">20</span>, <span class="dv">28</span>, <span class="dv">23</span>, <span class="dv">24</span>, <span class="dv">25</span>, <span class="dv">2</span>])</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set up the request with or without pagination (pageToken)</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> token:</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        request <span class="op">=</span> youtube.videos().<span class="bu">list</span>(</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>            part<span class="op">=</span><span class="st">"contentDetails,snippet,statistics,topicDetails"</span>,</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>            maxResults<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>            chart<span class="op">=</span><span class="st">"mostPopular"</span>,</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>            regionCode<span class="op">=</span>random_region,</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>            videoCategoryId<span class="op">=</span>random_category,  <span class="co"># Pick one random category for the search</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>            pageToken<span class="op">=</span>token  <span class="co"># Use nextPageToken for pagination if available</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>        request <span class="op">=</span> youtube.videos().<span class="bu">list</span>(</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>            part<span class="op">=</span><span class="st">"contentDetails,snippet,statistics,topicDetails"</span>,</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>            maxResults<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>            chart<span class="op">=</span><span class="st">"mostPopular"</span>,</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>            regionCode<span class="op">=</span>random_region,</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>            videoCategoryId<span class="op">=</span>random_category  <span class="co"># Pick one random category for the search</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> request.execute()</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> response</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-10" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> googleapiclient.errors <span class="im">import</span> HttpError</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> retrieve_200_videos():</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    all_videos <span class="op">=</span> []  <span class="co"># To store all retrieved videos</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set a target count</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    target_count <span class="op">=</span> <span class="dv">200</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    current_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># First request</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> retrieve_randomized_videos()</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop to gather data until we reach the target count</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> current_count <span class="op">&lt;</span> target_count:</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Process current page of results</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> item <span class="kw">in</span> response.get(<span class="st">'items'</span>, []):</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>                all_videos.append(item)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>                current_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Stop if we have reached the target count</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> current_count <span class="op">&gt;=</span> target_count:</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Check for nextPageToken</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>            next_page_token <span class="op">=</span> response.get(<span class="st">'nextPageToken'</span>)</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> next_page_token:</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="st">"No more pages available."</span>)</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span>  <span class="co"># Exit the loop if no more pages</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Fetch the next page</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>            response <span class="op">=</span> retrieve_randomized_videos(next_page_token)</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> HttpError <span class="im">as</span> e:</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>            current_count <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> current_count <span class="op">&lt;=</span> <span class="dv">0</span>:</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Display the number of collected videos</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Total videos collected: </span><span class="sc">{</span><span class="bu">len</span>(all_videos)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> all_videos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-11" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_video_details(all_videos):</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Extract relevant video details from a list of video data and return a structured DataFrame.</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">        all_videos (list): List of video data dictionaries.</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">        pd.DataFrame: DataFrame containing relevant video details.</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    all_video_info <span class="op">=</span> []</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define the fields to extract from each part of the API response</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    stats_to_keep <span class="op">=</span> {</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">'snippet'</span>: [<span class="st">'channelTitle'</span>, <span class="st">'title'</span>, <span class="st">'tags'</span>, <span class="st">'publishedAt'</span>],</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">'statistics'</span>: [<span class="st">'viewCount'</span>, <span class="st">'likeCount'</span>, <span class="st">'dislikeCount'</span>, <span class="st">'favoriteCount'</span>, <span class="st">'commentCount'</span>],</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">'contentDetails'</span>: [<span class="st">'duration'</span>, <span class="st">'definition'</span>, <span class="st">'caption'</span>],</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">'topicDetails'</span>: [<span class="st">'topicCategories'</span>]</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Iterate through all videos in the list</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> video <span class="kw">in</span> all_videos:</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>        video_info <span class="op">=</span> {}</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>        video_info[<span class="st">'video_id'</span>] <span class="op">=</span> video.get(<span class="st">'id'</span>, <span class="va">None</span>)</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extract details from each specified part</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> part, fields <span class="kw">in</span> stats_to_keep.items():</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> field <span class="kw">in</span> fields:</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>                <span class="cf">try</span>:</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Access nested fields safely</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>                    video_info[field] <span class="op">=</span> video.get(part, {}).get(field, <span class="va">None</span>)</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>                <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>                    video_info[field] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>        all_video_info.append(video_info)</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert the list of dictionaries into a DataFrame</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame(all_video_info)</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Example Usage:</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming `all_videos` contains the aggregated list of video data</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>all_videos <span class="op">=</span> retrieve_200_videos()</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> get_video_details(all_videos)</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>No more pages available.
Total videos collected: 150</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">video_id</th>
<th data-quarto-table-cell-role="th">channelTitle</th>
<th data-quarto-table-cell-role="th">title</th>
<th data-quarto-table-cell-role="th">tags</th>
<th data-quarto-table-cell-role="th">publishedAt</th>
<th data-quarto-table-cell-role="th">viewCount</th>
<th data-quarto-table-cell-role="th">likeCount</th>
<th data-quarto-table-cell-role="th">dislikeCount</th>
<th data-quarto-table-cell-role="th">favoriteCount</th>
<th data-quarto-table-cell-role="th">commentCount</th>
<th data-quarto-table-cell-role="th">duration</th>
<th data-quarto-table-cell-role="th">definition</th>
<th data-quarto-table-cell-role="th">caption</th>
<th data-quarto-table-cell-role="th">topicCategories</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>JQHZL3KefNk</td>
<td>Date</td>
<td>Kai Cenat Got PAYBACK The Helmet Game AGAIN! üò≠üíÄ</td>
<td>[Kai Cenat, Kai, Cenat, Kai Cenat Live, Kai Ce...</td>
<td>2024-11-19T19:39:52Z</td>
<td>67783623</td>
<td>2105665</td>
<td>None</td>
<td>0</td>
<td>2469</td>
<td>PT40S</td>
<td>hd</td>
<td>false</td>
<td>[https://en.wikipedia.org/wiki/Sport]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>MkoGUJFtt0Q</td>
<td>Vazho</td>
<td>The World's Most Hilarious and Hostile Mascot</td>
<td>None</td>
<td>2024-11-17T19:20:51Z</td>
<td>17693526</td>
<td>446088</td>
<td>None</td>
<td>0</td>
<td>1461</td>
<td>PT16S</td>
<td>hd</td>
<td>false</td>
<td>[https://en.wikipedia.org/wiki/Sport]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>6enUpPF-WA4</td>
<td>Rowan University</td>
<td>Hey Coach! üëã How many can Coach Jespersen gues...</td>
<td>None</td>
<td>2024-11-14T21:23:59Z</td>
<td>21672109</td>
<td>1592856</td>
<td>None</td>
<td>0</td>
<td>1701</td>
<td>PT1M</td>
<td>hd</td>
<td>false</td>
<td>[https://en.wikipedia.org/wiki/Sport]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>xUokiJu4rUE</td>
<td>Autumn Nations Series</td>
<td>HIGHLIGHTS | ITALY V NEW ZEALAND | AUTUMN NATI...</td>
<td>None</td>
<td>2024-11-23T22:48:19Z</td>
<td>461939</td>
<td>3772</td>
<td>None</td>
<td>0</td>
<td>758</td>
<td>PT5M48S</td>
<td>hd</td>
<td>false</td>
<td>[https://en.wikipedia.org/wiki/Sport]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>U2UQ7Io4OuU</td>
<td>Battleground MMA</td>
<td>üïµÔ∏è‚Äç‚ôÇÔ∏èRampage Jackson Admits Cheatingüß¥</td>
<td>[ufc, jaxxon podcast, mma, mma shorts, ufc sho...</td>
<td>2024-11-17T20:49:36Z</td>
<td>6572493</td>
<td>360710</td>
<td>None</td>
<td>0</td>
<td>1206</td>
<td>PT22S</td>
<td>hd</td>
<td>false</td>
<td>[https://en.wikipedia.org/wiki/Mixed_martial_a...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-12" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame()</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">100</span>):</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    all_videos <span class="op">=</span> retrieve_200_videos()</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    current_df <span class="op">=</span> get_video_details(all_videos)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.concat([df, current_df],  axis<span class="op">=</span><span class="dv">0</span>, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>No more pages available.
Total videos collected: 200
No more pages available.
Total videos collected: 183
No more pages available.
Total videos collected: 200
No more pages available.
Total videos collected: 40
No more pages available.
Total videos collected: 150
No more pages available.
Total videos collected: 200
No more pages available.
Total videos collected: 100
No more pages available.
Total videos collected: 150
No more pages available.
Total videos collected: 200
No more pages available.
Total videos collected: 150
No more pages available.
Total videos collected: 40
No more pages available.
Total videos collected: 200
No more pages available.
Total videos collected: 50
No more pages available.
Total videos collected: 200
No more pages available.
Total videos collected: 50
No more pages available.
Total videos collected: 200
No more pages available.
Total videos collected: 150
No more pages available.
Total videos collected: 200
No more pages available.
Total videos collected: 39
No more pages available.
Total videos collected: 50
No more pages available.
Total videos collected: 30
No more pages available.
Total videos collected: 150
No more pages available.
Total videos collected: 200
No more pages available.
Total videos collected: 200
No more pages available.
Total videos collected: 200
No more pages available.
Total videos collected: 150
No more pages available.
Total videos collected: 200
No more pages available.
Total videos collected: 200
No more pages available.
Total videos collected: 39
No more pages available.
Total videos collected: 150
No more pages available.
Total videos collected: 150
No more pages available.
Total videos collected: 30
No more pages available.
Total videos collected: 200
No more pages available.
Total videos collected: 123
No more pages available.
Total videos collected: 50
No more pages available.
Total videos collected: 100
No more pages available.
Total videos collected: 100
No more pages available.
Total videos collected: 159
No more pages available.
Total videos collected: 100
No more pages available.
Total videos collected: 100
No more pages available.
Total videos collected: 100
No more pages available.
Total videos collected: 100
No more pages available.
Total videos collected: 50
No more pages available.
Total videos collected: 200
No more pages available.
Total videos collected: 168
No more pages available.
Total videos collected: 30
No more pages available.
Total videos collected: 50
No more pages available.
Total videos collected: 50
No more pages available.
Total videos collected: 200
No more pages available.
Total videos collected: 200
No more pages available.
Total videos collected: 200
No more pages available.
Total videos collected: 131
No more pages available.
Total videos collected: 142
No more pages available.
Total videos collected: 123
No more pages available.
Total videos collected: 181
No more pages available.
Total videos collected: 50
No more pages available.
Total videos collected: 200
No more pages available.
Total videos collected: 100
No more pages available.
Total videos collected: 185
No more pages available.
Total videos collected: 200
No more pages available.
Total videos collected: 150
No more pages available.
Total videos collected: 150
No more pages available.
Total videos collected: 185
No more pages available.
Total videos collected: 200
No more pages available.
Total videos collected: 50
No more pages available.
Total videos collected: 50
No more pages available.
Total videos collected: 50
No more pages available.
Total videos collected: 100
No more pages available.
Total videos collected: 100
No more pages available.
Total videos collected: 200
No more pages available.
Total videos collected: 200
No more pages available.
Total videos collected: 200
No more pages available.
Total videos collected: 183
No more pages available.
Total videos collected: 200
No more pages available.
Total videos collected: 100
No more pages available.
Total videos collected: 30
No more pages available.
Total videos collected: 200
No more pages available.
Total videos collected: 200
No more pages available.
Total videos collected: 200
No more pages available.
Total videos collected: 128
No more pages available.
Total videos collected: 150
No more pages available.
Total videos collected: 150
No more pages available.
Total videos collected: 200
No more pages available.
Total videos collected: 150
No more pages available.
Total videos collected: 39
No more pages available.
Total videos collected: 150
No more pages available.
Total videos collected: 200
No more pages available.
Total videos collected: 200
No more pages available.
Total videos collected: 200
No more pages available.
Total videos collected: 150
No more pages available.
Total videos collected: 200
No more pages available.
Total videos collected: 50
No more pages available.
Total videos collected: 30
No more pages available.
Total videos collected: 200
No more pages available.
Total videos collected: 200
No more pages available.
Total videos collected: 30
No more pages available.
Total videos collected: 30
No more pages available.
Total videos collected: 100
No more pages available.
Total videos collected: 50
No more pages available.
Total videos collected: 200
          video_id                channelTitle  \
0      b6FTKe-u8XI         Richard Restatement   
1      W_19sjpQttw         Succesful Celebrity   
2      udVz8GN_DP0                   Kieran Ta   
3      iOecn1gSBZY                   M2M Heart   
4      u1IuChCXplQ                 9-1-1 house   
...            ...                         ...   
13593  -n0IhrYBDYk                 LifeofLogos   
13594  pr7rKo4qe2Y  Fire Department Chronicles   
13595  jqj3z9dU_fY             TRIPLE F.  T.V.   
13596  dYutqAk2b2M             ReelRenaissance   
13597  8i5zS9s_NnY               Aurora Cinema   

                                                   title  \
0      Can I get scout badge?#therookie #viralvideo #...   
1      Bill Nye The Science Guy Shows Kai Cenat A Sci...   
2      You‚Äôre not gonna hit me again, are you? #super...   
3      Open the cash with moneyü§£ü•µ||This is funniest r...   
4             He realized that they did not stop deathüò±üò≥   
...                                                  ...   
13593  Shane Gillis Turns On Tony Hinchcliffe!!!üòÇüòÇüòÇ| ...   
13594  Real things I‚Äôve seen as a Paramedic. Ginger s...   
13595  AMERICAN DAD GOT IT RIGHTüòÇ #2A #fyp #shorts #s...   
13596  This is not a simple cold.#shorts #doctor #series   
13597            Louise became Glenn's wife#shorts#funny   

                                                    tags  \
0                                                   None   
1      [Kai Cenat, Kai, Cenat, ImKaiCenat, AMP, Kai C...   
2                                                   None   
3                                                   None   
4                                                   None   
...                                                  ...   
13593                                               None   
13594                                               None   
13595                                               None   
13596                                               None   
13597                                               None   

                publishedAt viewCount likeCount dislikeCount favoriteCount  \
0      2024-11-20T22:42:00Z  10794179    877554         None             0   
1      2024-11-17T17:01:47Z  18001205   1219798         None             0   
2      2024-11-18T03:13:34Z   9926158    662739         None             0   
3      2024-11-16T13:00:53Z  15292454   1128563         None             0   
4      2024-11-20T19:52:08Z   7105386    439418         None             0   
...                     ...       ...       ...          ...           ...   
13593  2024-11-21T18:52:33Z   1399156     54085         None             0   
13594  2024-11-19T14:15:33Z   2797964    240984         None             0   
13595  2024-11-06T10:49:54Z   9416536    843711         None             0   
13596  2024-11-18T15:00:45Z    853024     36275         None             0   
13597  2024-11-13T23:00:12Z   6379147    364406         None             0   

      commentCount duration definition caption  \
0             1504    PT59S         hd   false   
1             5472    PT26S         hd   false   
2             1257    PT58S         hd   false   
3             2204    PT59S         hd   false   
4             1255     PT1M         hd   false   
...            ...      ...        ...     ...   
13593          339    PT34S         hd   false   
13594         1075    PT37S         hd   false   
13595         5292    PT35S         hd   false   
13596          127    PT58S         hd   false   
13597          226    PT59S         hd   false   

                                         topicCategories  
0      [https://en.wikipedia.org/wiki/Entertainment, ...  
1      [https://en.wikipedia.org/wiki/Entertainment, ...  
2      [https://en.wikipedia.org/wiki/Entertainment, ...  
3      [https://en.wikipedia.org/wiki/Entertainment, ...  
4      [https://en.wikipedia.org/wiki/Entertainment, ...  
...                                                  ...  
13593  [https://en.wikipedia.org/wiki/Entertainment, ...  
13594  [https://en.wikipedia.org/wiki/Entertainment, ...  
13595  [https://en.wikipedia.org/wiki/Entertainment, ...  
13596  [https://en.wikipedia.org/wiki/Entertainment, ...  
13597  [https://en.wikipedia.org/wiki/Entertainment, ...  

[13598 rows x 14 columns]</code></pre>
</div>
</div>
<div id="cell-13" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(df.video_id.unique())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>2578</code></pre>
</div>
</div>
<div id="cell-14" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"viewCount"</span>].describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>count    1.359800e+04
mean     5.373338e+06
std      1.084820e+07
min      6.958000e+03
25%      7.280870e+05
50%      2.552836e+06
75%      6.193342e+06
max      2.172830e+08
Name: viewCount, dtype: float64</code></pre>
</div>
</div>
<div id="cell-15" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"popularity"</span>] <span class="op">=</span> np.where(df[<span class="st">"viewCount"</span>] <span class="op">&gt;</span> <span class="dv">6000000</span>, <span class="st">"high"</span>, <span class="st">"low"</span>) <span class="co"># since the median is around 255000000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-16" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">"../../data/raw-data/youtube_data_raw.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="summary" class="level1">
<h1>Summary</h1>
<section id="we-finished-data-collection-on-11252024" class="level3">
<h3 class="anchored" data-anchor-id="we-finished-data-collection-on-11252024">We finished data collection on 11/25/2024</h3>
<p>we finally gatered youtube video data set with 13,598 rows and 15 columns in ‚Äòvideo_id‚Äô, ‚ÄòchannelTitle‚Äô, ‚Äòtitle‚Äô, ‚Äòtags‚Äô, ‚ÄòpublishedAt‚Äô, ‚ÄòviewCount‚Äô, ‚ÄòlikeCount‚Äô, ‚ÄòdislikeCount‚Äô, ‚ÄòfavoriteCount‚Äô, ‚ÄòcommentCount‚Äô, ‚Äòduration‚Äô, ‚Äòdefinition‚Äô, ‚Äòcaption‚Äô, ‚ÄòtopicCategories‚Äô, ‚Äòpopularity‚Äô. We saved the dataset into csv file for future usage. In which, the dataset has regression target such as ‚ÄòviewCount‚Äô, ‚ÄòlikeCount‚Äô; binary classification target such as ‚Äòdefinition‚Äô, ‚Äòcaption‚Äô,‚Äòpopularity‚Äô, and multiclass-classification target such as ‚ÄòtopicCategories‚Äô.</p>
</section>
<section id="challenges" class="level2">
<h2 class="anchored" data-anchor-id="challenges"><strong>Challenges</strong></h2>
<p>During the data collection phase, several technical challenges were encountered. These included:</p>
<ul>
<li><p><strong>API Limitations:</strong> The YouTube Data API‚Äôs rate limits required careful management of requests to ensure the collection process was both efficient and thorough, or we will receive HTTP error. Therefore, we include try except clasuses and ask the functions to sleep for seconds, and this step ensures the pipeline of retrieving data from API would not break in the middle.</p></li>
<li><p><strong>Data Diversity:</strong> Although we attempting to create a diverse dataset, balancing content across regions, categories, and popularity levels posed a challenge. Random sampling sometimes led to imbalanced subsets that required additional filtering and adjustments.</p></li>
<li><p><strong>Incomplete Metadata:</strong> Some videos lacked complete metadata fields, such as view counts or engagement statistics, leading to gaps in the dataset. These cases required exclusion or imputation strategies.</p></li>
<li><p><strong>Future Enhancement</strong>: As regression target, binary classification target, multiclass-classification target are required to be included, we will tune and classify the raw data in the data cleaning section to ensure the target labels exist.</p></li>
</ul>
</section>
<section id="benchmarks" class="level2">
<h2 class="anchored" data-anchor-id="benchmarks"><strong>Benchmarks</strong></h2>
<p>When comparing the collected dataset to industry benchmarks and intuitive expectations:</p>
<ul>
<li><p>The collected dataset is representative of English-speaking regions, enabling targeted analysis while adhering to linguistic and cultural consistency.</p></li>
<li><p>The features included in the dataset are generally being mentioned in social media analysis papers<span class="citation" data-cites="fiveable_social_media_analysis"><sup><a href="#ref-fiveable_social_media_analysis" role="doc-biblioref">1</a></sup></span>.</p></li>
</ul>
</section>
<section id="conclusion-and-future-steps" class="level2">
<h2 class="anchored" data-anchor-id="conclusion-and-future-steps"><strong>Conclusion and Future Steps</strong></h2>
<p>The data collection phase successfully generated a dataset of 13,598 rows and 15 columns, encapsulating a wide range of video metadata, including content details, engagement metrics, and categories. This dataset serves as a strong foundation for subsequent cleaning, processing, and analysis phases.</p>
<p>To improve this process further:</p>
<ul>
<li><p><strong>API Optimization:</strong> Employ parallel requests or caching mechanisms to handle rate limits more efficiently and speed up the collection process.</p></li>
<li><p><strong>Data Enrichment:</strong> Enrich the dataset with additional features, such as user demographics or sentiment analysis of comments, for richer insights.</p></li>
<li><p><strong>Scalability:</strong> Expand data collection to include non-English-speaking regions or underrepresented video categories to support more generalized findings.</p></li>
</ul>
<p>Future work should focus on utilizing this dataset to uncover trends in viewer engagement, analyze YouTube‚Äôs recommendation system, and provide actionable insights for content creators and marketers. These next steps will not only refine the dataset further but also help address the challenges and insights discovered during this phase.</p>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-fiveable_social_media_analysis" class="csl-entry" role="listitem">
<div class="csl-left-margin">1. </div><div class="csl-right-inline">Fiveable. <a href="https://library.fiveable.me/communication-research-methods/unit-12/social-media-content-analysis/study-guide/hU7sy3MuBl4CaXZ5">Social media content analysis: Communication research methods</a>. (2024).</div>
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>